<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Sagar's Portfolio</title>
    <link rel="stylesheet" href="stylesheet.css">
    <link rel="shortcut icon" href="images/logo.png" type="image/x-icon">
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js" integrity="sha512-KZmyTq3PLx9EZl0RHShHQuXtrvdJ+m35tuOiwlcZfs/rE7NZv29ygNA8SFCkMXTnYZQK2OX0Gm2qKGfvWEtRXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
    <script src="https://kit.fontawesome.com/58259be448.js" crossorigin="anonymous"></script>
</head>
<body>
     <!-- --------- wait for page content load --------- -->
    <div id="HidePageElement">
        <div id="loader-wrapper">
            <div id="loader"></div>
            <div class="loader-section-left"></div>
            <div class="loader-section-right"></div>
        </div>
    </div>
    <!-- --------------- home / header page ------------ -->

    <div id="header">
        <div class="container">
            <nav>
                <img src="images//logo1.png" class="logo" alt="logo">
                <ul id="sidemenu">
                    <li><a href="#header">Home</a></li>
                    <li><a href="#about">About</a></li>
                    <li><a href="#services">Services</a></li>
                    <li><a href="#portfolio">Portfolio</a></li>
                    <li><a href="#contact">Contact</a></li>
                    <i class='fas fa-times' onclick="closemenu()"></i>
                </ul>
                <i class='fas fa-bars' onclick="openmenu()"></i>
            </nav>
            <div class="header-text">
                <p>RPA Developer</p>
                <h1>Hi, I'm <span> Sagar </span><br>Das from West Bengal, India. </h1>
            </div>
        </div>
    </div>

    <!-- --------about page -------------- -->
    <div id="about">
        <div class="container">
            <div class="row">
                <div class="about-col-1">
                    <img src="images/user3.jpg" alt="">
                </div>
                <div class="about-col-2" >
                    <h1 class="sub-title">About Me</h1>
                    <p id="aboutMe-p">
                        
                    </p>
                    <div class="tab-title">
                        <p class="tab-links active-link" onclick="opentab('skills')">Skills</p>
                        <p class="tab-links" onclick="opentab('experience')">Experience</p>
                        <p class="tab-links" onclick="opentab('education')">Education</p>
                    </div>
                        <!-- -------  Skill -----  -->
                    <div class="tab-contents active-tab" id="skills">
                        
                    </div>
                    <!-- ------------ experience ---------------- -->
                    <div class="tab-contents" id="experience">
                        
                    </div>
                    <!-- ------------ Education ---------------- -->
                    <div class="tab-contents" id="education">
                        
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- ---------- services ------------  -->
    <div id="services">
        <div class="container">
            <h1 class="sub-title">My Services</h1>
            <div class="services-list">
                
            </div>
        </div>
    </div>
 <!-- ---------- portfolio-------------- -->
    <div id="portfolio">
        <div class="container">
            <h1 class="sub-title">My  Work</h1>
            <div class="work-list">
                
            </div>
              <a href="javascript:void(0)" onclick="javascript: alert('Thank you for showing interest\nWill update soon.')" class="btn">See more..</a>
        </div>
    </div>

 <!-- ------------------ contact form   ------------- -->
    <div id="contact">
        <div class="container">
            <div class="row">
                <div class="contact-left">
                    <h1 class="sub-title">Contact Me</h1>
                    <p><i class="fa fa-paper-plane"></i>sagardaa058@gmail.com</p>
                    <p><i class="fa fa-phone-square-alt"></i>7001139324</p>
                    <div class="social-icons">
                        <a href="https://www.facebook.com/Sagar.Sonu.Das3/"><i class="fa fa-facebook"></i></a>
                        <a href="https://www.linkedin.com/in/sagar-das-b182661a7/"><i class="fa fa-linkedin"></i></a>
                        <a href="https://github.com/sagar60"><i class="fa fa-github"></i></a>
                        <a href="https://twitter.com/sagardaa058"><i class="fa fa-twitter-square"></i></a>
                    </div>
                    <a href="#" target="_blank" onmouseover="javascript: this.href = PersonalInfoObj['Contact details'][0]['my-CV'];" download class="btn btn2">Download CV</a>
                </div>
                <div class="contact-right">
                    <form action="#" id="contactForm" method="post">
                        <input type="text" name="name" placeholder="Your Name" required>
                        <input type="email" name="email" placeholder="Your Email" required>
                        <textarea name="message" rows="6" placeholder="Your Message" required></textarea>
                        <div class="visitor-counter">
                            <div class="submit-btn">
                                <button type="submit" class="btn btn2">Submit</button>
                            </div>
                            <div id="total-visitor">
                                <div>
                                    <p>Total Visitor(s)</p>
                                    <p id="visitor-count">10</p>
                                </div>
                            </div>
                        </div>
                    </form>
                    <span id="msg"></span>
                </div>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2022 Sagar. All rights reserved. Collaboration with Google Apps Script Api.</p>
            <p>Thanks for visiting. <i class="fas fa-handshake"></i></p>
        </div>
    </div>


 <!-- -------- js script ------ -->

<script type="text/javascript">

    // open tab in about sedction
    const tablinks = document.getElementsByClassName("tab-links");
    const tabContents = document.getElementsByClassName("tab-contents");

    function opentab(tabname){
        // clear link
        for(tablink of tablinks){
            tablink.classList.remove("active-link")
        }
        // clear active tab
        for(tabContent of tabContents){
            tabContent.classList.remove("active-tab")
        }

        // active tab name
        event.currentTarget.classList.add('active-link');
        tabContents[tabname].classList.add('active-tab')
    }

    // fold side menu
    const sideMenu =document.getElementById('sidemenu');
    function openmenu(){
        sideMenu.style.right = '0';
    }
    function closemenu(){
        sideMenu.style.right = '-200px';
    }

    // store personal data info from gsheet
    const PersonalInfoObj = {}
    function getPersonalInfo(){
        // deploy id for getting personal info
        //let deployId = 'AKfycbzvRmwlramrwUDUN19Kc79RNMQLMCwE2_6seFp78khHg68sKaFJfjMa5V-oxfEs46D4';
        let deployId = 'AKfycbxDKFa2edq8LRhMVWE6XpwAjRzSaYcnNuXA7QYlg_MNRpOZb9T_ymf-69LJNxuZbuAh';

        fetch(`https://script.google.com/macros/s/${deployId}/exec`)
        .then( (data)=> data.json())
        .then((data)=> {data.message === 'success'? 
            Object.assign(PersonalInfoObj,data.data) : 
            console.error('error getting personal info');

            // prevent to delete of exist property but exist property can be update
            //Object.seal(PersonalInfoObj);

            // prevent from all the changes in object
            Object.freeze(PersonalInfoObj);

            // design html 
            for(let key in PersonalInfoObj){
                //console.log(key);
                // if id exist
                if(key.trim && document.getElementById(key.toString().toLowerCase())){
                    // console.log(PersonalInfoObj[key]);
                    const HTMLID = document.getElementById(key.toString().toLowerCase());
                    const ULElement = document.createElement('ul');
                    PersonalInfoObj[key].forEach((element,index) => {
                        // console.log(Object.keys(element)[0]);
                        // console.log(Object.values(element)[0]);
                        ULElement.innerHTML += `
                        <li><span>${Object.keys(element)[0]}</span><br>${Object.values(element)[0]}</li>
                        `;
                    });
                    //console.log(ULElement)
                    // append to html tag child
                    HTMLID.appendChild(ULElement);
                }
                // others type
                if(!key){
                    const viewKey = "";
                    // console.log(PersonalInfoObj[key]);
                    // console.log( getvalue(PersonalInfoObj[key],viewKey));

                    // about me text
                    const aboutKey = 'about me';
                    let returnValue = getvalue(PersonalInfoObj[key], aboutKey)
                    if(returnValue){
                        document.getElementById('aboutMe-p').innerHTML = returnValue;
                    }

                    // total visitor
                    const VisitorKey =  'TotalVisitedUser'
                    returnValue = getvalue(PersonalInfoObj[key],VisitorKey);
                    if(returnValue){
                        // console.log(returnValue);
                        if(returnValue[1].toString().toLowerCase().includes('yes')){
                            document.getElementById('total-visitor').style.display = "block";
                            document.getElementById('visitor-count').innerHTML = returnValue[0];
                        }
                    }

                }
                // extract service data
                if(key.includes('My Services')){
                    PersonalInfoObj[key].forEach((element,index) => {
                        let DivElement = document.createElement('div');
                        //console.log(JSON.parse(element['description']))
                        DivElement.innerHTML = `
                        <i class="${JSON.parse(element['description'])['logo']}" ></i>
                        <h2>${Object.keys(element)[0]}</h2>
                        <p>
                            ${Object.values(element)[0]}
                        </p>
                        <a href="#">Learn more</a>
                        `;
                        //console.log(DivElement);
                        document.getElementsByClassName('services-list')[0].appendChild(DivElement);
                    });
                }
                // extract work details
                if(key.includes('My Work list')){
                    const WorkListTagElement = document.getElementsByClassName('work-list')[0];
                    PersonalInfoObj[key].forEach((element,index) => {
                        //console.log(JSON.parse(element['description']));

                        // extract work details from api
                        let WorkDetailsPTag = "";
                        Object.values(element)[0].split(/ {2}/).forEach((workData)=>{
                            WorkDetailsPTag+= `
                            <p>
                                ${workData}
                            </P>`;
                        });
                        //console.log(JSON.parse(element['description'])['imageUrl']);
                        
                        // extract image location
                        // in between regex syntax 
                        //(?<=start)(.*)(?=end)
                        const ImgSRC = "https://drive.google.com/uc?export=view&id=" + JSON.parse(element['description'])['imageUrl'].match(/(?<=\/d\/)(.*)(?=\/view)/)[0];
                        //console.log(ImgSRC);
                        const workTag = document.createElement('div');
                        workTag.classList.add('work');

                        const img = document.createElement('img');
                        (async () => {
                        
                        // to not to cache in the test, set src dynamically
                        img.src = ImgSRC;

                        //console.log('height before', img.naturalHeight); // 0
                        this.intTotalAsyncUsed++;
                        
                        await waitForImage(img);
                        //console.log('height after', img.naturalHeight); // 48
                            //testing
                        ContentVisible();
                        })();

                        workTag.appendChild(img);
                        workTag.innerHTML += `
                            <div class="layer">
                                <h3>${Object.keys(element)[0]}</h3>
                                ${WorkDetailsPTag}
                                <a href="#"><i class='fas fa-external-link-alt'></i></a>
                            </div>
                        `;
                        //console.log(DivElement);
                        //document.getElementsByClassName('services-list')[0].appendChild(DivElement);
                        WorkListTagElement.appendChild(workTag);
                    });

                }
            }
            function waitForImage(imgElem) {
                // console.log('wait')
                return new Promise(res => {
                    if (imgElem.complete) {
                        return res();
                    }
                    imgElem.onload = () => res();
                    imgElem.onerror = () => res();
                });
            }

            ContentVisible();
        })
        .catch( error => console.error('error!', error.message));
    }
    // call the function
    getPersonalInfo();

    // get other key values
    function getvalue(arr,keyValue){
        //console.log(arr);
        let result= null;
        arr.forEach((element)=>{
            if(Object.keys(element).includes(keyValue)){
                // console.log(element);
                const index = Object.keys(element).indexOf(keyValue);
                result = [...Object.values(element)];
                return true;
            }
        })
        return result;
    }

    // on contact form submit
    document.getElementById('contactForm').addEventListener('submit',(e)=>{
        e.preventDefault();
        // initialize obj
        const contactInfo = {}
        //console.log(e)
        for(let node of e.target.children){
            if(node.type != 'submit'){
                //console.dir(node)
                contactInfo[node.name] = node.value;
            }
        }
        //console.log(contactInfo);

        const msgSpan = document.getElementById('msg');
        // upload data to gsheet
        let deviceDetails;
        // browser type check
        if ("ontouchstart" in document.documentElement){
             deviceDetails= 'Mobile';
        }
        else{
            deviceDetails ='Desktop';
        }
        // const deployId = 'AKfycbz2iLGYykCrQR9b39sfphbt9dvNZUImIyblpqIbhBoggApdYcCzmCoskEG800yT10po';
        const deployId = 'AKfycbyeblfKaovUZGnfZ6LXPvaZtAUUHdlD923ZxI2GTQ6nYiKW76hdUseSK_2X4nJf96f8';
        const cTime = new Date().toLocaleString("en-US", {timeZone: 'Asia/Kolkata'});

        fetch(`https://script.google.com/macros/s/${deployId}/exec?name=${contactInfo.name}&email=${contactInfo.email}&message=${contactInfo.message}&deviceDetail=${deviceDetails}&time=${cTime}`)
        .then( (data)=> data.json())
        .then((data)=> {
            msgSpan.innerHTML = 'Message sent successfully. Thanks for writing me. ';
            setTimeout(() => {
                msgSpan.innerHTML = '';
            }, 5000);
            // clear form 
            document.getElementById('contactForm').reset();
        })
        .catch( error => console.error('error!', error.message));
    });
    
    // page full content refresh check
    const HidePageElement = document.getElementById('HidePageElement');

    var ApiNumber = 0;
    var intTotalAsyncUsed = 1;
    
    function ContentVisible(){
        this.ApiNumber++;
        
        // hide loader 
        if(this.ApiNumber == intTotalAsyncUsed){
            document.getElementById('loader').style.display='none';
            document.getElementsByClassName('loader-section-left')[0].classList.add('active');
            document.getElementsByClassName('loader-section-right')[0].classList.add('active');
            setTimeout(()=>{
                document.getElementsByClassName('loader-section-left')[0].classList.remove('active');
                document.getElementsByClassName('loader-section-right')[0].classList.remove('active');
                HidePageElement.style.display = 'none';
            },800)
        }
        // console.log(this.ApiNumber,intTotalApiUsed);
    }

    // Store user info in sheet
    function storeUserInfo(){
        fetch('https://api.db-ip.com/v2/free/self')
        .then(data => data.json())
        .then(data => {
            // console.log(data)
            const city = data.city;
            const ipAddress = data.ipAddress;
            const ContinentCode = data.continentCode;
            const ContinentName = data.continentName;
            const ContryCode = data.countryCode;
            const CountryName = data.countryName;
            const state = data.stateProv;

            const userDeployAPIId = 'AKfycbxKDWTPSCLS5LI2jO64VMkKu1Xg9k-YyXTIftWIRGHXpOpgIAQFjjSPBCHSl8kUf2Aw';
            const api = `https://script.google.com/macros/s/${userDeployAPIId}/exec?ipAddress=${ipAddress}&continentCode=${ContinentCode}&continentName=${ContinentName}&countryCode=${ContryCode}&countryName=${CountryName}&stateProv=${state}&city=${city}`

            fetch(api)
            .then(data =>data.json())
            .then(data => {
                // console.log(data)
            })
            .catch(error => console.error(error))

            // console.log(api);
        })
        .catch(error => console.error(error))
    }
    // call store function
    storeUserInfo();
</script>
